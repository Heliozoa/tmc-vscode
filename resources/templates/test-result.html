<html>
    <head>
        {{{cspBlob}}}
        <style>
            {{{cssBlob}}}
        </style>
    </head>

    <body>
        <div class="container">
            <button type="button" class="close" aria-label="Close" onclick="closeWindow()">
                <span aria-hidden="true">&times;</span>
            </button>
            {{#if testResult.testResults}}
            <div class="row m-0">
                <div class="col-md-10 pr-0">
                    {{{ check_test_status testResult.status testResult.logs undefined pasteLink }}}
                </div>
            </div>
            <div class="row m-0" style="line-height: 0;">
                <div class="col-md-10 py-2">
                    {{{ progress_bar testResult.testResults}}}
                </div>
                <div class="col-md-2 py-2">
                    <input type="checkbox" id="showAll" name="showAll" style="margin-top: 1px;" />
                    <label for="showAll">Show all</label>
                </div>
            </div>

            <div class="row m-0">
                <div class="col-md-10" id="testResultPlaceholder">
                    Test results can't be shown.
                </div>
            </div>

            {{else}} {{{ check_test_status testResult.status testResult.logs tmcLogs }}} {{/if}}
            <!-- close if testResults array empty -->
        </div>
        <!-- close container -->
        <script>
            const vscode = acquireVsCodeApi();
            const exerciseId = {{id}};

            function submitToServer() {
                vscode.postMessage({ type: 'submitToServer', data: { exerciseId: exerciseId } });
            }
            function closeWindow() {
                vscode.postMessage({ type: "closeWindow" });
            }
            function sendToPaste() {
                vscode.postMessage({ type: 'sendToPaste', data: { exerciseId } });
            }

            const coll = document.getElementsByClassName("collapsible");
            if (coll[0]) {
                coll[0].addEventListener("click", function() {
                    this.classList.toggle("active");
                    let content = this.nextElementSibling;
                    if (content.style.maxHeight){
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            }

            const all = `{{{show_test_results testResult.testResults true}}}`;
            const firstFailed = `{{{show_test_results testResult.testResults false}}}`;
            const showall = document.getElementById("showAll");

            if (firstFailed) {
                document.getElementById("testResultPlaceholder").innerHTML = firstFailed;
            } else {
                document.getElementById("testResultPlaceholder").innerHTML = all;
                showall.checked = true;
            }

            showall.addEventListener("change", function() {
                if (this.checked) {
                    document.getElementById("testResultPlaceholder").innerHTML = all;
                    return;
                }
                document.getElementById("testResultPlaceholder").innerHTML = firstFailed;
            });

            function copyText() {
                const copyText = document.getElementById("copyPasteLink");
                copyText.select();
                document.execCommand("copy");
                const copied = document.getElementById("copied");
                copied.innerHTML = "Copied!";
            }
        </script>
    </body>
</html>
