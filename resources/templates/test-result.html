<html>
    <head>
        {{{cspBlob}}}
        <style>
            {{{cssBlob}}}
        </style>
    </head>

    <body>
        <div class="container">
            <button type="button" class="close" aria-label="Close" onclick="closeWindow()">
                <span aria-hidden="true">&times;</span>
            </button>
            {{#if testResult.testResults}}
            <div class="row">
                <div class="py-2">
                    {{{ check_test_status testResult.status testResult.logs undefined pasteLink }}}
                </div>
            </div>
            <div class="row">
                {{{ progress_bar testResult.testResults}}}
            </div>
            {{#each testResult.testResults}}

            <div class="row {{#if this.successful}}passed{{else}}failed{{/if}} my-2">
                <div class="col">
                    <div class="row">
                        {{#if this.successful}}
                        <div class="col-md-1 passed-header">
                            PASS:
                        </div>
                        {{else}}
                        <div class="col-md-1 failed-header">
                            FAIL:
                        </div>
                        {{/if}}
                        <div class="col-md">
                            <span>{{this.name}}</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <pre>{{this.message}}</pre>
                        </div>
                    </div>
                </div>
            </div>
            <!-- close row passed or failed -->
            {{/each}} {{else}} {{{ check_test_status testResult.status testResult.logs tmcLogs }}}
            {{/if}}
            <!-- close if testResulsts array empty -->
        </div>
        <!-- close container -->
        <script>
            const vscode = acquireVsCodeApi();
            const exerciseId = {{id}};
            {{#if pasteLink}}
                const triggerPaste = true;
            {{else}}
                const triggerPaste = false;
            {{/if}}

            function submitToServer() {
                vscode.postMessage({ type: 'submitToServer', data: { exerciseId: exerciseId } });
            }
            function closeWindow() {
                vscode.postMessage({ type: "closeWindow" });
            }
            function sendToPaste() {
                vscode.postMessage({ type: 'sendToPaste', data: { exerciseId } });
            }

            const coll = document.getElementsByClassName("collapsible");
            coll[0].addEventListener("click", function() {
                this.classList.toggle("active");
                let content = this.nextElementSibling;
                if (content.style.maxHeight){
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            });

            function copyText() {
                const copyText = document.getElementById("copyPasteLink");
                copyText.select();
                document.execCommand("copy");
                const copied = document.getElementById("copied");
                copied.innerHTML = "Copied!";
            }

            if (triggerPaste) {
                coll[0].click();
            }
        </script>
    </body>
</html>
