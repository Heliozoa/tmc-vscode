<html>
    <head>
        {{{cspBlob}}}
        <style>
            {{{cssBlob}}}
        </style>
    </head>

    <body>
        <div class="container">
            <div>
                <div class="py-2">
                    <h2>Processing submission...</h2>
                </div>
                <div class="py-2">
                    <input
                        type="button"
                        onclick="runInBackground()"
                        class="btn btn-primary"
                        value="Run in background"
                    />
                    <input
                        type="button"
                        onclick="showInBrowser()"
                        class="btn btn-primary show-in-browser"
                        value="Show submission in browser"
                        disabled
                    />
                </div>
                <div>
                    {{#check_submission_status messages progressPct}}
                    <h3>{{status}}</h3>
                    {{/check_submission_status}}
                </div>
            </div>
        </div>

        <script>
            const vscode = acquireVsCodeApi();
            let submission_url = "";

            function runInBackground() {
                vscode.postMessage({ type: "closeWindow" });
            }
            function showInBrowser() {
                vscode.postMessage({
                    type: "showSubmissionInBrowser",
                    data: { submissionUrl: submission_url },
                });
            }

            window.addEventListener("message", function (event) {
                const message = event.data;
                switch (message.command) {
                    case "showSubmissionUrl":
                        document.querySelector("input.show-in-browser").disabled = false;
                        submission_url = message.url;
                        break;
                }
            });
        </script>
    </body>
</html>
